def show_beauty_score_visualization(self, current_ratios):
        """ë·°í‹° ìŠ¤ì½”ì–´ ì‹œê°í™” (ì›í˜• ì˜ì—­ + í¼ì„¼í‹°ì§€)"""
        if self.face_landmarks is None:
            print("ì–¼êµ´ì´ ê²€ì¶œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
            return
            
        # ê¸°ì¡´ í‘œì‹œ ì œê±°
        self.canvas.delete("ratio_indicators")
        self.canvas.delete("proportion_lines")
        
        print("ë·°í‹° ìŠ¤ì½”ì–´ ì‹œê°í™”ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤...")
        
        try:
            # 1. 1/5 ì„¸ë¡œ ë¹„ë¡€ì„  (5ë“±ë¶„)
            self.draw_fifth_proportion_lines()
            
            # 2. 1/3 ê°€ë¡œ ë¹„ë¡€ì„  (3ë“±ë¶„) 
            self.draw_third_proportion_lines()
            
            # 3. ê° ë¶€ìœ„ë³„ ì›í˜• ì ìˆ˜ í‘œì‹œ
            self.draw_beauty_score_indicators(current_ratios)
            
            # 4. êµì°¨ì  ê¸°ë°˜ ì› ê·¸ë¦¬ê¸°
            self.draw_intersection_circle()
            
            # 5. ë‘ ë²ˆì§¸ êµì°¨ì  ì› ê·¸ë¦¬ê¸°  
            self.draw_second_intersection_circle()
            
            # 6. ëœë“œë§ˆí¬ 37ì„ ì§€ë‚˜ëŠ” ìˆ˜í‰ì„ 
            self.draw_landmark_37_line()
            
            # 7. ì™¼ìª½ í…Œë‘ë¦¬ì™€ 1/3ì„ , 37ì„  êµì°¨ì ì„ ì§€ë¦„ìœ¼ë¡œ í•˜ëŠ” ì›
            self.draw_left_intersection_circle_1()
            
            # 8. ì™¼ìª½ í…Œë‘ë¦¬ì™€ í•˜ë‹¨ í…Œë‘ë¦¬, 37ì„  êµì°¨ì ì„ ì§€ë¦„ìœ¼ë¡œ í•˜ëŠ” ì›  
            self.draw_left_intersection_circle_2()
            
            # 9-13. ìƒë‹¨ í…Œë‘ë¦¬ 5ê°œ ì›ë“¤
            self.draw_top_border_circles()
            
            # ëˆˆê°„ê²© ë° ì…ì½”ë¹„ìœ¨ ì‹œê°í™” ì œê±° (ë·°í‹° ìŠ¤ì½”ì–´ì—ì„œ ì‚­ì œ)
            
            # 14. í„± ê³¡ë¥  ì‹œê°í™”
            self.draw_jaw_curvature()
            
            # 15ì´ˆ í›„ ìë™ ì œê±°
            self.root.after(15000, lambda: [
                self.canvas.delete("ratio_indicators"),
                self.canvas.delete("proportion_lines"),
                self.canvas.delete("intersection_circle"),
                self.canvas.delete("second_circle"),
                self.canvas.delete("landmark_37_line"),
                self.canvas.delete("left_circle_1"),
                self.canvas.delete("left_circle_2"),
                self.canvas.delete("top_circles"),
                self.canvas.delete("jaw_curvature"),  # í„± ê³¡ë¥  ì‚­ì œ
                self.canvas.delete("ratio_lines")  # ë¹„ìœ¨ ë¼ì¸ë„ ì‚­ì œ
            ])
            print("ë·°í‹° ìŠ¤ì½”ì–´ ì‹œê°í™”ê°€ 15ì´ˆê°„ í‘œì‹œë©ë‹ˆë‹¤.")
            
        except Exception as e:
            print(f"ë·°í‹° ìŠ¤ì½”ì–´ ì‹œê°í™” ì¤‘ ì˜¤ë¥˜: {str(e)}")

    def show_ratio_lines(self, current_ratios):
        """ì–¼êµ´ ë¹„ìœ¨ ë¼ì¸ê³¼ ìˆ˜ì¹˜ë¥¼ ì‹œê°ì ìœ¼ë¡œ í‘œì‹œ"""
        if self.face_landmarks is None:
            print("ì–¼êµ´ì´ ê²€ì¶œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
            return
            
        # ê¸°ì¡´ ë¼ì¸ ì œê±°
        self.canvas.delete("ratio_lines")
        
        print("ì–¼êµ´ ë¹„ìœ¨ ë¼ì¸ì„ í‘œì‹œí•©ë‹ˆë‹¤...")
        
        try:
            # 1. ì „ì²´ ì–¼êµ´ ë¹„ìœ¨ ë¼ì¸ (ê¸¸ì´:ë„ˆë¹„)
            self.draw_face_outline_ratio(current_ratios)
            
            # 2. ì–¼êµ´ ì‚¼ë“±ë¶„ ë¼ì¸
            self.draw_face_thirds_ratio(current_ratios)
            
            # 3. ëˆˆ ê°„ê²© ë¹„ìœ¨ ë¼ì¸ê³¼ ìˆ˜ì¹˜ í‘œì‹œ
            self.draw_eye_spacing_ratio(current_ratios)
            self.draw_eye_spacing_percentage(current_ratios)
            
            # 4. ì…/ì½” ë„ˆë¹„ ë¹„ìœ¨ ë¼ì¸ê³¼ ìˆ˜ì¹˜ í‘œì‹œ
            self.draw_mouth_nose_ratio(current_ratios)
            self.draw_mouth_nose_percentage(current_ratios)
            
            # 5. í™©ê¸ˆë¹„ìœ¨ ê°€ì´ë“œë¼ì¸
            self.draw_golden_ratio_guide()
            
            # 10ì´ˆ í›„ ìë™ ì œê±°
            self.root.after(10000, lambda: self.canvas.delete("ratio_lines"))
            print("ë¹„ìœ¨ ë¼ì¸ì´ 10ì´ˆê°„ í‘œì‹œë©ë‹ˆë‹¤.")
            
        except Exception as e:
            print(f"ë¹„ìœ¨ ë¼ì¸ í‘œì‹œ ì¤‘ ì˜¤ë¥˜: {str(e)}")
    
    def draw_fifth_proportion_lines(self):
        """1/5 ì„¸ë¡œ ë¹„ë¡€ì„  ê·¸ë¦¬ê¸° (ê° ì„ ì´ íŠ¹ì • ëœë“œë§ˆí¬ë¥¼ ì§€ë‚˜ë„ë¡)"""
        face_top = self.get_landmark_coordinates(10)
        face_bottom = self.get_landmark_coordinates(152)
        face_left = self.get_landmark_coordinates(234)
        face_right = self.get_landmark_coordinates(454)
        
        # ê° ë¹„ë¡€ì„ ì´ ì§€ë‚˜ëŠ” ëœë“œë§ˆí¬ë“¤
        landmark_33 = self.get_landmark_coordinates(33)   # 1/5: ì™¼ìª½ ëˆˆ ë°”ê¹¥ìª½
        landmark_133 = self.get_landmark_coordinates(133) # 2/5: ì™¼ìª½ ëˆˆ ì•ˆìª½
        landmark_362 = self.get_landmark_coordinates(362) # 3/5: ì˜¤ë¥¸ìª½ ëˆˆ ì•ˆìª½  
        landmark_359 = self.get_landmark_coordinates(359) # 4/5: ì˜¤ë¥¸ìª½ ëˆˆ ë°”ê¹¥ìª½
        landmark_447 = self.get_landmark_coordinates(447) # 5/5: ê°€ì¥ ì˜¤ë¥¸ìª½
        
        landmarks = [None, landmark_33, landmark_133, landmark_362, landmark_359, landmark_447]
        labels = ["0/5", "1/5 (ëˆˆì™¸)", "2/5 (ëˆˆë‚´)", "3/5 (ëˆˆë‚´)", "4/5 (ëˆˆì™¸)", "5/5 (447)"]
        
        if all([face_top, face_bottom, face_left, face_right]) and all(landmarks[1:]):
            face_width = self.calculate_distance(face_left, face_right)
            top_y = face_top[1]
            bottom_y = face_bottom[1]
            
            # ì„¸ë¡œì„  ê·¸ë¦¬ê¸° (6ê°œ: 0/5, 1/5, 2/5, 3/5, 4/5, 5/5)
            # 1/3ì„ ê³¼ 3/3ì„  y ì¢Œí‘œ êµ¬í•˜ê¸° (5/5ì„  ë¶„ë¦¬ìš©)
            landmark_8 = self.get_landmark_coordinates(8)   # 1/3ì„ 
            face_bottom = self.get_landmark_coordinates(152) # 3/3ì„ 
            
            for i in range(6):
                if i in [1, 2, 3, 4, 5]:  # ëœë“œë§ˆí¬ ê¸°ì¤€ì„ ë“¤
                    x = landmarks[i][0]
                else:  # ì™¸ê³½ì„ ë“¤ (0/5ë§Œ)
                    ratio = i / 5.0
                    x = face_left[0] + (face_width * ratio)
                
                # ëª¨ë“  ì„¸ë¡œì„ ì—ì„œ 1/3~3/3 êµ¬ê°„ì„ ì œì™¸í•˜ê³  ë‘ ê°œì˜ ì„ ë¶„ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ê·¸ë¦¬ê¸°
                if landmark_8 and face_bottom:
                    # ì²« ë²ˆì§¸ ì„ ë¶„: ìƒë‹¨~1/3ì„ 
                    start_screen_1 = self.image_to_screen_coords(x, top_y)
                    end_screen_1 = self.image_to_screen_coords(x, landmark_8[1])
                    
                    if start_screen_1 and end_screen_1:
                        # ìƒ‰ìƒ ë° êµµê¸° ì„¤ì •
                        color = "white"
                        if i in [1, 2, 3, 4, 5]:  # ëœë“œë§ˆí¬ ê¸°ì¤€ì„ ë“¤
                            width = 1.5
                        else:  # ì™¸ê³½ì„  (0/5ë§Œ)
                            width = 0.5
                            
                        self.canvas.create_line(
                            start_screen_1[0], start_screen_1[1],
                            end_screen_1[0], end_screen_1[1],
                            fill=color, width=width, dash=(3, 2), tags="proportion_lines"
                        )
                    
                    # ë‘ ë²ˆì§¸ ì„ ë¶„: 3/3ì„ ~í•˜ë‹¨
                    start_screen_2 = self.image_to_screen_coords(x, face_bottom[1])
                    end_screen_2 = self.image_to_screen_coords(x, bottom_y)
                    
                    if start_screen_2 and end_screen_2:
                        # ìƒ‰ìƒ ë° êµµê¸° ì„¤ì •
                        color = "white"
                        if i in [1, 2, 3, 4, 5]:  # ëœë“œë§ˆí¬ ê¸°ì¤€ì„ ë“¤
                            width = 1.5
                        else:  # ì™¸ê³½ì„  (0/5ë§Œ)
                            width = 0.5
                            
                        self.canvas.create_line(
                            start_screen_2[0], start_screen_2[1],
                            end_screen_2[0], end_screen_2[1],
                            fill=color, width=width, dash=(3, 2), tags="proportion_lines"
                        )
                else:
                    # ë‹¤ë¥¸ ì„¸ë¡œì„ ë“¤ì€ ê¸°ì¡´ëŒ€ë¡œ ì „ì²´ ê¸¸ì´ë¡œ ê·¸ë¦¬ê¸°
                    start_screen = self.image_to_screen_coords(x, top_y)
                    end_screen = self.image_to_screen_coords(x, bottom_y)
                    
                    if start_screen and end_screen:
                        # ìƒ‰ìƒ ë° êµµê¸° ì„¤ì • (ëª¨ë‘ í°ìƒ‰, êµµê¸° ì ˆë°˜)
                        color = "white"
                        if i in [1, 2, 3, 4, 5]:  # ëœë“œë§ˆí¬ ê¸°ì¤€ì„ ë“¤
                            width = 1.5  # ê¸°ì¡´ 3ì—ì„œ ì ˆë°˜ìœ¼ë¡œ ê°ì†Œ
                        else:  # ì™¸ê³½ì„  (0/5ë§Œ)
                            width = 0.5  # ê¸°ì¡´ 1ì—ì„œ ì ˆë°˜ìœ¼ë¡œ ê°ì†Œ
                        
                        self.canvas.create_line(
                            start_screen[0], start_screen[1],
                            end_screen[0], end_screen[1],
                            fill=color, width=width, dash=(3, 2), tags="proportion_lines"
                        )
                    
                    # ë¹„ë¡€ ë¼ë²¨ ì œê±° (ë·°í‹° ìŠ¤ì½”ì–´ì—ì„œ í…ìŠ¤íŠ¸ ìˆ¨ê¹€)
    
    def draw_third_proportion_lines(self):
        """1/3 ê°€ë¡œ ë¹„ë¡€ì„  ê·¸ë¦¬ê¸° (ê° ì„ ì´ íŠ¹ì • ëœë“œë§ˆí¬ë¥¼ ì§€ë‚˜ë„ë¡)"""
        face_top = self.get_landmark_coordinates(10)
        face_bottom = self.get_landmark_coordinates(152)
        face_left = self.get_landmark_coordinates(234)
        face_right = self.get_landmark_coordinates(454)
        
        # ê° ë¹„ë¡€ì„ ì´ ì§€ë‚˜ëŠ” ëœë“œë§ˆí¬ë“¤
        landmark_8 = self.get_landmark_coordinates(8) # 1/3: ì´ë§ˆ-ëˆˆì¹ ê²½ê³„
        landmark_2 = self.get_landmark_coordinates(2)     # 2/3: ì½” ë
        
        landmarks = [None, landmark_8, landmark_2, None]
        labels = ["0/3", "1/3 (ì´ë§ˆ)", "2/3 (ì½”)", "3/3"]
        
        if all([face_top, face_bottom, face_left, face_right]) and all([landmark_8, landmark_2]):
            face_height = self.calculate_distance(face_top, face_bottom)
            left_x = face_left[0]
            right_x = face_right[0]
            
            # ê°€ë¡œì„  ê·¸ë¦¬ê¸° (3ê°œ: 1/3, 2/3, 3/3) - ìµœìƒë‹¨ 0/3 í…Œë‘ë¦¬ì„  ì œì™¸
            for i in range(1, 4):  # 0ì€ ì œì™¸í•˜ê³  1, 2, 3ë§Œ
                if i == 1:  # 1/3 ì„ ì€ ëœë“œë§ˆí¬ 8ì„ ì§€ë‚˜ëŠ” ìˆ˜í‰ì„ 
                    y = landmark_8[1]
                elif i == 2:  # 2/3 ì„ ì€ ëœë“œë§ˆí¬ 2ë¥¼ ì§€ë‚˜ëŠ” ìˆ˜í‰ì„ 
                    y = landmark_2[1]
                else:  # ì™¸ê³½ì„ ë“¤ (3/3ë§Œ)
                    ratio = i / 3.0
                    y = face_top[1] + (face_height * ratio)
                
                start_screen = self.image_to_screen_coords(left_x, y)
                end_screen = self.image_to_screen_coords(right_x, y)
                
                if start_screen and end_screen:
                    # ìƒ‰ìƒ ë° êµµê¸° ì„¤ì • (ëª¨ë‘ í°ìƒ‰, êµµê¸° ì ˆë°˜)
                    color = "white"
                    if i in [1, 2]:  # ëœë“œë§ˆí¬ ê¸°ì¤€ì„ ë“¤
                        width = 1.5  # ê¸°ì¡´ 3ì—ì„œ ì ˆë°˜ìœ¼ë¡œ ê°ì†Œ
                    else:  # ì™¸ê³½ì„ 
                        width = 0.5  # ê¸°ì¡´ 1ì—ì„œ ì ˆë°˜ìœ¼ë¡œ ê°ì†Œ
                    
                    self.canvas.create_line(
                        start_screen[0], start_screen[1],
                        end_screen[0], end_screen[1],
                        fill=color, width=width, dash=(4, 3), tags="proportion_lines"
                    )
                    
                    # ë¹„ë¡€ ë¼ë²¨ ì œê±° (ë·°í‹° ìŠ¤ì½”ì–´ì—ì„œ í…ìŠ¤íŠ¸ ìˆ¨ê¹€)
    
    def draw_beauty_score_indicators(self, current_ratios):
        """ê° ë¶€ìœ„ë³„ ë·°í‹° ìŠ¤ì½”ì–´ ì›í˜• ì§€ì‹œê¸° í‘œì‹œ"""
        # ê° ë¶€ìœ„ë³„ ì ìˆ˜ ê³„ì‚° (í™©ê¸ˆë¹„ìœ¨ ëŒ€ë¹„ í¼ì„¼í‹°ì§€)
        scores = self.calculate_beauty_scores(current_ratios)
        
        # ì£¼ìš” ì–¼êµ´ íŠ¹ì§•ì ë“¤ì˜ ìœ„ì¹˜ì— ì›í˜• ì§€ì‹œê¸° í‘œì‹œ (ì´ë§ˆ, ëˆˆê°„ê²©, ëˆˆí¬ê¸°, ì… ì› ì œê±°)
        indicators = [
            # (ëœë“œë§ˆí¬, ì ìˆ˜í‚¤, ë¼ë²¨, ìƒ‰ìƒ, ì˜¤í”„ì…‹)
            (2, "ì½”ê¸¸ì´", "ì½”", "#96CEB4", (30, 0)),          # ì½” ë
            (172, "í„±ë¼ì¸", "í„±", "#DDA0DD", (0, 30))         # í„± ë
        ]
        
        for landmark_id, score_key, label, color, offset in indicators:
            landmark = self.get_landmark_coordinates(landmark_id)
            if landmark and score_key in scores:
                screen_pos = self.image_to_screen_coords(landmark[0], landmark[1])
                if screen_pos:
                    x = screen_pos[0] + offset[0]
                    y = screen_pos[1] + offset[1]
                    
                    self.draw_circular_ratio_indicator(
                        x, y, 25, scores[score_key], label, color
                    )
    
    def calculate_beauty_scores(self, current_ratios):
        """í™©ê¸ˆë¹„ìœ¨ ëŒ€ë¹„ ë·°í‹° ìŠ¤ì½”ì–´ ê³„ì‚° (100% ë§Œì )"""
        scores = {}
        
        # ì „ì²´ ì–¼êµ´ ë¹„ìœ¨ ì ìˆ˜
        if "ì „ì²´_ì–¼êµ´_ë¹„ìœ¨" in current_ratios:
            ideal = self.FACE_GOLDEN_RATIOS["ì „ì²´_ì–¼êµ´_ë¹„ìœ¨"]
            current = current_ratios["ì „ì²´_ì–¼êµ´_ë¹„ìœ¨"]
            score = max(0, 100 - abs(current - ideal) / ideal * 100)
            scores["ì´ë§ˆ"] = score
        
        # ëˆˆ ê°„ê²© ì ìˆ˜
        if "ëˆˆ_ê°„ê²©" in current_ratios:
            ideal = 1.0
            current = current_ratios["ëˆˆ_ê°„ê²©"]
            score = max(0, 100 - abs(current - ideal) / ideal * 100)
            scores["ëˆˆê°„ê²©"] = score
            scores["ëˆˆí¬ê¸°"] = score * 0.9  # ëˆˆí¬ê¸°ëŠ” ì•½ê°„ ë‹¤ë¥¸ ì ìˆ˜
        
        # ì… ë„ˆë¹„ ì ìˆ˜
        if "ì…_ë„ˆë¹„" in current_ratios:
            ideal = self.FACE_GOLDEN_RATIOS["ì…_ë„ˆë¹„"]
            current = current_ratios["ì…_ë„ˆë¹„"]
            score = max(0, 100 - abs(current - ideal) / ideal * 100)
            scores["ì…í¬ê¸°"] = score
        
        # ì–¼êµ´ ì‚¼ë“±ë¶„ ì ìˆ˜
        if "ì–¼êµ´_ì‚¼ë“±ë¶„" in current_ratios:
            ideal = 1.0
            current = current_ratios["ì–¼êµ´_ì‚¼ë“±ë¶„"]
            score = max(0, 100 - abs(current - ideal) / ideal * 100)
            scores["ì½”ê¸¸ì´"] = score
            scores["í„±ë¼ì¸"] = score * 0.8
        
        return scores
    
    def draw_circle_from_intersections(self, point1_coords, point2_coords, color, label, tag, label_offset=(10, -20)):
        """ë‘ êµì°¨ì ì„ ì§€ë¦„ìœ¼ë¡œ í•˜ëŠ” ì›ì„ ê·¸ë¦¬ëŠ” í†µì¼ëœ í•¨ìˆ˜"""
        if not point1_coords or not point2_coords:
            return
            
        # í™”ë©´ ì¢Œí‘œë¡œ ë³€í™˜
        point1_screen = self.image_to_screen_coords(point1_coords[0], point1_coords[1])
        point2_screen = self.image_to_screen_coords(point2_coords[0], point2_coords[1])
        
        if point1_screen and point2_screen:
            # ì›ì˜ ì¤‘ì‹¬ì ê³¼ ë°˜ì§€ë¦„ ê³„ì‚°
            center_x = (point1_screen[0] + point2_screen[0]) / 2
            center_y = (point1_screen[1] + point2_screen[1]) / 2
            
            import math
            distance = math.sqrt(
                (point2_screen[0] - point1_screen[0])**2 + 
                (point2_screen[1] - point1_screen[1])**2
            )
            radius = distance / 2
            
            # ë„¤ì˜¨ì‚¬ì¸ íš¨ê³¼ë¥¼ ìœ„í•œ ìƒ‰ìƒ ì„¤ì •
            neon_red = "#FF0040"  # ë°ì€ ë„¤ì˜¨ ë¹¨ê°„ìƒ‰
            
            # ì› ê·¸ë¦¬ê¸° (redëŠ” ì‹¤ì„  + ë„¤ì˜¨ íš¨ê³¼, ë‚˜ë¨¸ì§€ëŠ” ì ì„ )
            if color == "red":
                # ë¹¨ê°„ìƒ‰ ì›ì€ ì–‡ì€ ì‹¤ì„ ìœ¼ë¡œ ê·¸ë¦¬ê¸° (30% ë” ì–‡ê²Œ)
                self.canvas.create_oval(
                    center_x - radius, center_y - radius,
                    center_x + radius, center_y + radius,
                    outline=neon_red, width=1.0, tags=tag  # 1.5 -> 1.0ìœ¼ë¡œ 30% ê°ì†Œ
                )
            else:
                # ë‹¤ë¥¸ ìƒ‰ìƒì€ ì ì„ ìœ¼ë¡œ ê·¸ë¦¬ê¸° (íŒŒë€ìƒ‰ì€ êµµê¸° 50% ê°ì†Œ)
                dash_patterns = {
                    "#FF1493": (5, 5),  # ë”¥í•‘í¬
                    "#00CED1": (7, 3),  # ë‹¤í¬í„°ì¿¼ì´ì¦ˆ
                    "#32CD32": (4, 4),  # ë¼ì„ê·¸ë¦°
                    "#FF8C00": (6, 2),  # ë‹¤í¬ì˜¤ë Œì§€
                    "#9370DB": (8, 2),  # ë¯¸ë””ì—„í¼í”Œ
                    "#8A2BE2": (3, 5),  # ë¸”ë£¨ë°”ì´ì˜¬ë ›
                    "#FF69B4": (4, 3),  # í•«í•‘í¬
                    "#FFA500": (5, 4),  # ì˜¤ë Œì§€
                    "blue": (4, 4),     # íŒŒë€ìƒ‰
                }
                dash = dash_patterns.get(color, (5, 5))
                
                # íŒŒë€ìƒ‰ ì›ì€ êµµê¸°ë¥¼ 30% ë” ì–‡ê²Œ (1.5 -> 1.0)
                width = 1.0 if color == "blue" else 3
                
                self.canvas.create_oval(
                    center_x - radius, center_y - radius,
                    center_x + radius, center_y + radius,
                    outline=color, width=width, dash=dash, tags=tag
                )
            
            # êµì°¨ì  ë§ˆì»¤ (ë¹¨ê°„ìƒ‰ì€ ë„¤ì˜¨ íš¨ê³¼ ì ìš©)
            point_radius = 4
            marker_color = neon_red if color == "red" else color
            for point_screen in [point1_screen, point2_screen]:
                self.canvas.create_oval(
                    point_screen[0] - point_radius, point_screen[1] - point_radius,
                    point_screen[0] + point_radius, point_screen[1] + point_radius,
                    fill=marker_color, outline=marker_color, width=2, tags=tag
                )
            
            # ì§€ë¦„ì„  (ë¹¨ê°„ìƒ‰ê³¼ íŒŒë€ìƒ‰ ì›ì€ ì§€ë¦„ì„  ì œê±°, ë‹¤ë¥¸ ìƒ‰ìƒë§Œ ì ì„ ìœ¼ë¡œ ê·¸ë¦¬ê¸°)
            if color != "red" and color != "blue":
                # ë¹¨ê°„ìƒ‰ê³¼ íŒŒë€ìƒ‰ì´ ì•„ë‹Œ ìƒ‰ìƒë§Œ ì ì„ ìœ¼ë¡œ ê·¸ë¦¬ê¸°
                line_dash = {
                    "#FF1493": (3, 3),
                    "#00CED1": (4, 2), 
                    "#32CD32": (3, 3),
                    "#FF8C00": (2, 4),
                    "#9370DB": (3, 2),
                    "#8A2BE2": (2, 3),  # ë¸”ë£¨ë°”ì´ì˜¬ë ›
                    "#FF69B4": (3, 4),  # í•«í•‘í¬
                    "#FFA500": (4, 3),  # ì˜¤ë Œì§€
                }
                self.canvas.create_line(
                    point1_screen[0], point1_screen[1],
                    point2_screen[0], point2_screen[1],
                    fill=color, width=2, dash=line_dash.get(color, (3, 3)), tags=tag
                )
            
            # ë·°í‹° ìŠ¤ì½”ì–´ì—ì„œëŠ” ì •ë³´ ë¼ë²¨ í‘œì‹œí•˜ì§€ ì•ŠìŒ (ë„¤ëª¨ë°•ìŠ¤ì™€ í…ìŠ¤íŠ¸ ì œê±°)
    
    def draw_intersection_circle(self):
        """ì²« ë²ˆì§¸ êµì°¨ì  ì›: 1/3 ì´ë§ˆì„ ê³¼ 2/3 ì½”ì„ ì´ 5/5ì„ ê³¼ ë§Œë‚˜ëŠ” ì ë“¤"""
        landmark_8 = self.get_landmark_coordinates(8)  # 1/3 ì´ë§ˆì„ 
        landmark_2 = self.get_landmark_coordinates(2)      # 2/3 ì½”ì„   
        landmark_447 = self.get_landmark_coordinates(447)  # 5/5ì„ 
        
        if all([landmark_8, landmark_2, landmark_447]):
            right_vertical_x = landmark_447[0]
            
            # êµì°¨ì  ê³„ì‚°
            point1 = (right_vertical_x, landmark_8[1])  # 1/3ì„  Ã— 5/5ì„ 
            point2 = (right_vertical_x, landmark_2[1])    # 2/3ì„  Ã— 5/5ì„ 
            
            self.draw_circle_from_intersections(
                point1, point2, 
                color="red", 
                label="ğŸ”´ ìš°ìƒ êµì°¨ì›", 
                tag="intersection_circle",
                label_offset=(10, -20)
            )
            
            # ìˆ˜ì§ ê±°ë¦¬ ëŒ€ë¹„ ì§€ë¦„ ë¹„ìœ¨ ê³„ì‚° ë° í‘œì‹œ
            self.draw_circle_diameter_ratio(point1, point2, "upper_right")
    
    def draw_second_intersection_circle(self):
        """ë‘ ë²ˆì§¸ êµì°¨ì  ì›: 2/3 ì½”ì„ ê³¼ 3/3 í„±ì„ ì´ 5/5ì„ ê³¼ ë§Œë‚˜ëŠ” ì ë“¤"""
        landmark_2 = self.get_landmark_coordinates(2)      # 2/3 ì½”ì„ 
        face_bottom = self.get_landmark_coordinates(152)   # 3/3 í„±ì„ 
        landmark_447 = self.get_landmark_coordinates(447)  # 5/5ì„ 
        
        if all([landmark_2, face_bottom, landmark_447]):
            right_vertical_x = landmark_447[0]
            
            # êµì°¨ì  ê³„ì‚°  
            point1 = (right_vertical_x, landmark_2[1])    # 2/3ì„  Ã— 5/5ì„ 
            point2 = (right_vertical_x, face_bottom[1])   # 3/3ì„  Ã— 5/5ì„ 
            
            self.draw_circle_from_intersections(
                point1, point2,
                color="red",
                label="ğŸ”´ ìš°í•˜ êµì°¨ì›",
                tag="second_circle", 
                label_offset=(10, 30)
            )
            
            # ìˆ˜ì§ ê±°ë¦¬ ëŒ€ë¹„ ì§€ë¦„ ë¹„ìœ¨ ê³„ì‚° ë° í‘œì‹œ
            self.draw_circle_diameter_ratio(point1, point2, "lower_right")
    
    def draw_landmark_37_line(self):
        """ëœë“œë§ˆí¬ 37ì„ ì§€ë‚˜ëŠ” ìˆ˜í‰ì„  ê·¸ë¦¬ê¸°"""
        face_left = self.get_landmark_coordinates(234)
        face_right = self.get_landmark_coordinates(454)
        landmark_37 = self.get_landmark_coordinates(37)  # í•˜ì•ˆê²€ ë¼ì¸
        
        if all([face_left, face_right, landmark_37]):
            left_x = face_left[0]
            right_x = face_right[0]
            line_y = landmark_37[1]  # ëœë“œë§ˆí¬ 37ì˜ y ì¢Œí‘œ
            
            # í™”ë©´ ì¢Œí‘œë¡œ ë³€í™˜
            start_screen = self.image_to_screen_coords(left_x, line_y)
            end_screen = self.image_to_screen_coords(right_x, line_y)
            
            if start_screen and end_screen:
                # ìˆ˜í‰ì„ ë§Œ ê·¸ë¦¬ê¸° (ëœë“œë§ˆí¬ ì ê³¼ í…ìŠ¤íŠ¸ ì œê±°)
                self.canvas.create_line(
                    start_screen[0], start_screen[1],
                    end_screen[0], end_screen[1],
                    fill="#9370DB", width=2, dash=(6, 4), tags="landmark_37_line"
                )
    
    def draw_left_intersection_circle_1(self):
        """ì¢Œìƒ êµì°¨ì›: ì™¼ìª½ í…Œë‘ë¦¬ì™€ 2/3 ì½”ì„ (37ì„  ë°”ë¡œ ìœ„), 37ì„  êµì°¨ì ì„ ì§€ë¦„ìœ¼ë¡œ í•˜ëŠ” ì›"""
        face_left = self.get_landmark_coordinates(234)     # ì™¼ìª½ í…Œë‘ë¦¬
        landmark_2 = self.get_landmark_coordinates(2)      # 2/3 ì½”ì„  (37ì„  ë°”ë¡œ ìœ„)
        landmark_37 = self.get_landmark_coordinates(37)    # 37ì„ 
        
        if all([face_left, landmark_2, landmark_37]):
            left_vertical_x = face_left[0]
            
            # êµì°¨ì  ê³„ì‚°
            point1 = (left_vertical_x, landmark_2[1])   # ì™¼ìª½í…Œë‘ë¦¬ Ã— 2/3ì½”ì„ 
            point2 = (left_vertical_x, landmark_37[1])  # ì™¼ìª½í…Œë‘ë¦¬ Ã— 37ì„ 
            
            self.draw_circle_from_intersections(
                point1, point2,
                color="blue",
                label="ğŸ”µ ì¢Œìƒ êµì°¨ì›", 
                tag="left_circle_1",
                label_offset=(-160, -20)
            )
            
            # ì¢Œìƒ ì›ì˜ ì§€ë¦„ ë¹„ìœ¨ ê³„ì‚° ë° í‘œì‹œ
            self.draw_left_circle_diameter_ratio(point1, point2, "upper_left")
    
    def draw_left_intersection_circle_2(self):
        """ì¢Œí•˜ êµì°¨ì›: ì™¼ìª½ í…Œë‘ë¦¬ì™€ í•˜ë‹¨ í…Œë‘ë¦¬, 37ì„  êµì°¨ì ì„ ì§€ë¦„ìœ¼ë¡œ í•˜ëŠ” ì›"""
        face_left = self.get_landmark_coordinates(234)     # ì™¼ìª½ í…Œë‘ë¦¬
        face_bottom = self.get_landmark_coordinates(152)   # í•˜ë‹¨ í…Œë‘ë¦¬  
        landmark_37 = self.get_landmark_coordinates(37)    # 37ì„ 
        
        if all([face_left, face_bottom, landmark_37]):
            left_vertical_x = face_left[0]
            
            # êµì°¨ì  ê³„ì‚°
            point1 = (left_vertical_x, face_bottom[1])  # ì™¼ìª½í…Œë‘ë¦¬ Ã— í•˜ë‹¨í…Œë‘ë¦¬
            point2 = (left_vertical_x, landmark_37[1])  # ì™¼ìª½í…Œë‘ë¦¬ Ã— 37ì„ 
            
            self.draw_circle_from_intersections(
                point1, point2,
                color="blue", 
                label="ğŸ”µ ì¢Œí•˜ êµì°¨ì›",
                tag="left_circle_2",
                label_offset=(-160, 30)
            )
            
            # ì¢Œí•˜ ì›ì˜ ì§€ë¦„ ë¹„ìœ¨ ê³„ì‚° ë° í‘œì‹œ
            self.draw_left_circle_diameter_ratio(point1, point2, "lower_left")
    
    def draw_top_border_circles(self):
        """ìƒë‹¨ í…Œë‘ë¦¬ì— 5ê°œì˜ ì› ê·¸ë¦¬ê¸° (ê° ìˆ˜ì§ì„  êµ¬ê°„ë³„)"""
        # í•„ìš”í•œ ëœë“œë§ˆí¬ë“¤
        face_top = self.get_landmark_coordinates(10)       # ìƒë‹¨ í…Œë‘ë¦¬
        face_left = self.get_landmark_coordinates(234)     # 0/5 ì™¼ìª½ í…Œë‘ë¦¬
        landmark_33 = self.get_landmark_coordinates(33)    # 1/5
        landmark_133 = self.get_landmark_coordinates(133)  # 2/5
        landmark_362 = self.get_landmark_coordinates(362)  # 3/5
        landmark_359 = self.get_landmark_coordinates(359)  # 4/5
        landmark_447 = self.get_landmark_coordinates(447)  # 5/5
        
        # ëª¨ë“  ëœë“œë§ˆí¬ê°€ ìˆëŠ”ì§€ í™•ì¸
        if all([face_top, face_left, landmark_33, landmark_133, landmark_362, landmark_359, landmark_447]):
            top_y = face_top[1]  # ìƒë‹¨ í…Œë‘ë¦¬ì˜ y ì¢Œí‘œ
            
            # 5ê°œì˜ ìˆ˜ì§ì„  x ì¢Œí‘œë“¤
            vertical_lines = [
                face_left[0],        # 0/5
                landmark_33[0],      # 1/5
                landmark_133[0],     # 2/5
                landmark_362[0],     # 3/5
                landmark_359[0],     # 4/5
                landmark_447[0]      # 5/5
            ]
            
            # ì „ì²´ ì–¼êµ´ ê°€ë¡œ ê¸¸ì´ ê³„ì‚°
            total_face_width = landmark_447[0] - face_left[0]
            
            # ì›ë“¤ì˜ ìƒ‰ìƒê³¼ ë¼ë²¨ ì •ì˜ (ëª¨ë‘ redë¡œ ë³€ê²½)
            circle_configs = [
                {"color": "red", "label": "ğŸ”´ ìƒ1êµ¬ê°„", "emoji": "1âƒ£"},  # ë¹¨ê°„ìƒ‰
                {"color": "red", "label": "ğŸ”´ ìƒ2êµ¬ê°„", "emoji": "2âƒ£"},  # ë¹¨ê°„ìƒ‰
                {"color": "red", "label": "ğŸ”´ ìƒ3êµ¬ê°„", "emoji": "3âƒ£"},  # ë¹¨ê°„ìƒ‰
                {"color": "red", "label": "ğŸ”´ ìƒ4êµ¬ê°„", "emoji": "4âƒ£"},  # ë¹¨ê°„ìƒ‰
                {"color": "red", "label": "ğŸ”´ ìƒ5êµ¬ê°„", "emoji": "5âƒ£"}   # ë¹¨ê°„ìƒ‰
            ]
            
            # 5ê°œ ì› ê·¸ë¦¬ê¸°
            for i in range(5):
                x1 = vertical_lines[i]     # ì™¼ìª½ ìˆ˜ì§ì„ 
                x2 = vertical_lines[i + 1] # ì˜¤ë¥¸ìª½ ìˆ˜ì§ì„ 
                
                # ë‘ êµì°¨ì  ê³„ì‚°
                point1 = (x1, top_y)  # ì™¼ìª½ êµì°¨ì 
                point2 = (x2, top_y)  # ì˜¤ë¥¸ìª½ êµì°¨ì 
                
                config = circle_configs[i]
                
                # ë¼ë²¨ ìœ„ì¹˜ ì¡°ì • (ì›ì´ ê²¹ì¹˜ì§€ ì•Šë„ë¡)
                label_offset_y = -80 - (i * 15)  # ê° ì›ë§ˆë‹¤ ë‹¤ë¥¸ ë†’ì´
                
                # ì´ êµ¬ê°„ì˜ ê°€ë¡œ ê¸¸ì´ ë° í¼ì„¼í‹°ì§€ ê³„ì‚°
                section_width = abs(x2 - x1)
                percentage = (section_width / total_face_width) * 100 if total_face_width > 0 else 0
                
                self.draw_circle_from_intersections(
                    point1, point2,
                    color=config["color"],
                    label=config["label"],
                    tag="top_circles",
                    label_offset=(0, label_offset_y)
                )
                
                # ì›ì˜ ì¤‘ì•™ì— í¼ì„¼í‹°ì§€ í‘œì‹œ
                self.draw_circle_center_percentage(point1, point2, percentage, config["color"])
    
    def draw_circle_center_percentage(self, point1, point2, percentage, color):
        """ì›ì˜ ì¤‘ì•™ì— í¼ì„¼í‹°ì§€ í…ìŠ¤íŠ¸ í‘œì‹œ"""
        # ì›ì˜ ì¤‘ì‹¬ì  ê³„ì‚° (ë‘ êµì°¨ì ì˜ ì¤‘ì )
        center_x = (point1[0] + point2[0]) / 2
        center_y = (point1[1] + point2[1]) / 2
        
        # í™”ë©´ ì¢Œí‘œë¡œ ë³€í™˜
        center_screen = self.image_to_screen_coords(center_x, center_y)
        
        if center_screen:
            # í¼ì„¼í‹°ì§€ í…ìŠ¤íŠ¸ (ë°°ê²½ ì—†ì´ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ 1.5ë°° í¬ê¸°)
            self.canvas.create_text(
                center_screen[0], center_screen[1],
                text=f"{percentage:.1f}%", anchor="center",
                fill="red", font=("Arial", 14, "bold"), tags="top_circles"
            )
    
    def draw_circle_diameter_ratio(self, point1, point2, circle_type):
        """ì›ì˜ ì¤‘ì•™ì— ìˆ˜ì§ ê±°ë¦¬ ëŒ€ë¹„ ì§€ë¦„ ë¹„ìœ¨ í‘œì‹œ"""
        # 1/3ì„ ê³¼ 3/3ì„ ì˜ y ì¢Œí‘œ êµ¬í•˜ê¸°
        landmark_8 = self.get_landmark_coordinates(8)  # 1/3ì„ 
        face_bottom = self.get_landmark_coordinates(152)   # 3/3ì„ 
        
        if not all([landmark_8, face_bottom]):
            return
        
        # ì „ì²´ ìˆ˜ì§ ê±°ë¦¬ (1/3ì„ ì—ì„œ 3/3ì„ ê¹Œì§€)
        total_vertical_distance = abs(face_bottom[1] - landmark_8[1])
        
        # í˜„ì¬ ì›ì˜ ì§€ë¦„ (ë‘ êµì°¨ì  ê°„ ê±°ë¦¬)
        circle_diameter = abs(point2[1] - point1[1])
        
        # ë¹„ìœ¨ ê³„ì‚°
        if total_vertical_distance > 0:
            ratio = (circle_diameter / total_vertical_distance) * 100
            
            # ì›ì˜ ì¤‘ì‹¬ì  ê³„ì‚°
            center_x = (point1[0] + point2[0]) / 2
            center_y = (point1[1] + point2[1]) / 2
            
            # í™”ë©´ ì¢Œí‘œë¡œ ë³€í™˜
            center_screen = self.image_to_screen_coords(center_x, center_y)
            
            if center_screen:
                # ë¹„ìœ¨ í…ìŠ¤íŠ¸ (ë°°ê²½ ì—†ì´ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ 1.5ë°° í¬ê¸°)
                tag = "intersection_circle" if circle_type == "upper_right" else "second_circle"
                self.canvas.create_text(
                    center_screen[0], center_screen[1],
                    text=f"{ratio:.1f}%", anchor="center",
                    fill="red", font=("Arial", 14, "bold"), tags=tag
                )
    
    def draw_left_circle_diameter_ratio(self, point1, point2, circle_type):
        """ì™¼ìª½ ì›ì˜ ì¤‘ì•™ì— ì´ ì§€ë¦„ ëŒ€ë¹„ ê° ì›ì˜ ì§€ë¦„ ë¹„ìœ¨ í‘œì‹œ"""
        # ì¢Œìƒ ì›ê³¼ ì¢Œí•˜ ì›ì˜ êµì°¨ì ë“¤ì„ êµ¬í•´ì„œ ì´ ì§€ë¦„ì„ ê³„ì‚°
        face_left = self.get_landmark_coordinates(234)     # ì™¼ìª½ í…Œë‘ë¦¬
        landmark_2 = self.get_landmark_coordinates(2)      # 2/3 ì½”ì„ 
        face_bottom = self.get_landmark_coordinates(152)   # í•˜ë‹¨ í…Œë‘ë¦¬
        landmark_37 = self.get_landmark_coordinates(37)    # 37ì„ 
        
        if not all([face_left, landmark_2, face_bottom, landmark_37]):
            return
        
        # ì¢Œìƒ ì›ì˜ ì§€ë¦„ (2/3ì½”ì„ ì—ì„œ 37ì„ ê¹Œì§€)
        upper_diameter = abs(landmark_37[1] - landmark_2[1])
        
        # ì¢Œí•˜ ì›ì˜ ì§€ë¦„ (í•˜ë‹¨í…Œë‘ë¦¬ì—ì„œ 37ì„ ê¹Œì§€) 
        lower_diameter = abs(landmark_37[1] - face_bottom[1])
        
        # ì´ ì§€ë¦„ (2/3ì½”ì„ ì—ì„œ í•˜ë‹¨í…Œë‘ë¦¬ê¹Œì§€)
        total_diameter = upper_diameter + lower_diameter
        
        # í˜„ì¬ ì›ì˜ ì§€ë¦„
        current_diameter = abs(point2[1] - point1[1])
        
        # ë¹„ìœ¨ ê³„ì‚°
        if total_diameter > 0:
            ratio = (current_diameter / total_diameter) * 100
            
            # ì›ì˜ ì¤‘ì‹¬ì  ê³„ì‚°
            center_x = (point1[0] + point2[0]) / 2
            center_y = (point1[1] + point2[1]) / 2
            
            # í™”ë©´ ì¢Œí‘œë¡œ ë³€í™˜
            center_screen = self.image_to_screen_coords(center_x, center_y)
            
            if center_screen:
                # ë¹„ìœ¨ í…ìŠ¤íŠ¸ (íŒŒë€ìƒ‰ìœ¼ë¡œ í‘œì‹œ)
                tag = "left_circle_1" if circle_type == "upper_left" else "left_circle_2"
                self.canvas.create_text(
                    center_screen[0], center_screen[1],
                    text=f"{ratio:.1f}%", anchor="center",
                    fill="blue", font=("Arial", 9, "bold"), tags=tag
                )

    def draw_jaw_curvature(self):
        """í•˜ì•…ê°ê³¼ í„±ëª©ê°ì„ ê³„ì‚°í•˜ì—¬ ë¦¬í”„íŒ… íš¨ê³¼ ì ìˆ˜í™”"""
        import math
        
        # í•˜ì•…ê°(Gonial Angle) ê³„ì‚°
        gonial_angle = self.calculate_gonial_angle()
        
        # í„±ëª©ê°(Cervicomental Angle) ê³„ì‚°  
        cervicomental_angle = self.calculate_cervicomental_angle()
        
        if gonial_angle is None or cervicomental_angle is None:
            print("í„± ê°ë„ë¥¼ ê³„ì‚°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return
        
        # ë¦¬í”„íŒ… íš¨ê³¼ ì ìˆ˜ ê³„ì‚° (ë‚ ì¹´ë¡œìš¸ìˆ˜ë¡ ë†’ì€ ì ìˆ˜)
        lifting_score = self.calculate_lifting_score(gonial_angle, cervicomental_angle)
        
        # ì ìˆ˜ ì‹œê°í™”
        self.display_jaw_angles_score(gonial_angle, cervicomental_angle, lifting_score)
        
        print(f"í•˜ì•…ê°: {gonial_angle:.1f}Â°, í„±ëª©ê°: {cervicomental_angle:.1f}Â°, ë¦¬í”„íŒ…ì ìˆ˜: {lifting_score:.0f}/100")
    
    def calculate_gonial_angle(self):
        """í•˜ì•…ê°(Gonial Angle) ê³„ì‚°: í•˜ì•…ì§€ì™€ í•˜ì•…ì²´ ì‚¬ì´ì˜ ê°ë„"""
        import math
        
        # ì˜¬ë°”ë¥¸ í•˜ì•…ê° ì¸¡ì •ì„ ìœ„í•œ ëœë“œë§ˆí¬
        # ì™¼ìª½: ê·€ ì•ìª½(234) - í„± ëª¨ì„œë¦¬(172) - í„± ì¤‘ì•™ ë°©í–¥
        # ì˜¤ë¥¸ìª½: ê·€ ì•ìª½(454) - í„± ëª¨ì„œë¦¬(397) - í„± ì¤‘ì•™ ë°©í–¥
        
        # ì™¼ìª½ í•˜ì•…ê° ê³„ì‚°
        left_ear = self.get_landmark_coordinates(234)       # ì™¼ìª½ ê·€ ì•ìª½ (ì–¼êµ´ ê°€ì¥ìë¦¬)
        left_jaw_corner = self.get_landmark_coordinates(172)  # ì™¼ìª½ í„± ëª¨ì„œë¦¬
        left_jaw_mid = self.get_landmark_coordinates(150)   # ì™¼ìª½ í„±ì„  ì¤‘ê°„
        
        # ì˜¤ë¥¸ìª½ í•˜ì•…ê° ê³„ì‚°  
        right_ear = self.get_landmark_coordinates(454)      # ì˜¤ë¥¸ìª½ ê·€ ì•ìª½ (ì–¼êµ´ ê°€ì¥ìë¦¬)
        right_jaw_corner = self.get_landmark_coordinates(397) # ì˜¤ë¥¸ìª½ í„± ëª¨ì„œë¦¬
        right_jaw_mid = self.get_landmark_coordinates(379)  # ì˜¤ë¥¸ìª½ í„±ì„  ì¤‘ê°„
        
        if not all([left_ear, left_jaw_corner, left_jaw_mid, right_ear, right_jaw_corner, right_jaw_mid]):
            return None
        
        # ì¢Œìš° í•˜ì•…ê° ê³„ì‚° (ìˆ˜ì§ì„ ì„ ê¸°ì¤€ìœ¼ë¡œ ê°ë„ ì¸¡ì •)
        left_gonial = self.calculate_jaw_angle_improved(left_ear, left_jaw_corner, left_jaw_mid)
        right_gonial = self.calculate_jaw_angle_improved(right_ear, right_jaw_corner, right_jaw_mid)
        
        if left_gonial is None or right_gonial is None:
            return None
        
        # í‰ê·  í•˜ì•…ê° (ì–‘ìª½ í‰ê· )
        avg_gonial = (left_gonial + right_gonial) / 2
        return avg_gonial
    
    def calculate_cervicomental_angle(self):
        """í„±ëª©ê°(Cervicomental Angle) ê³„ì‚°: í„±ëê³¼ ëª© ì‚¬ì´ì˜ ê°ë„"""
        import math
        
        # í„±ëª©ê°ì„ êµ¬ì„±í•˜ëŠ” í¬ì¸íŠ¸ë“¤
        # 1. í„±ë: 152
        # 2. ëª© ì•ìª½ ìµœì „ë°©ì : 18 (ì•„ë˜ì…ìˆ  í•˜ë‹¨ì„ ëª© ëŒ€ìš©ìœ¼ë¡œ ì‚¬ìš©)
        # 3. ëª© ì•„ë˜ìª½ ê°€ìƒì : í„±ëì—ì„œ ìˆ˜ì§ ì•„ë˜ë¡œ ì¼ì • ê±°ë¦¬
        
        chin = self.get_landmark_coordinates(152)           # í„±ë
        neck_front = self.get_landmark_coordinates(18)      # ëª© ì•ìª½ (ì•„ë˜ì…ìˆ  í•˜ë‹¨)
        
        if not all([chin, neck_front]):
            return None
        
        # ëª© ì•„ë˜ìª½ ê°€ìƒì  ìƒì„± (í„±ëì—ì„œ ìˆ˜ì§ ì•„ë˜ë¡œ)
        neck_bottom = (chin[0], chin[1] + abs(chin[1] - neck_front[1]) * 1.5)
        
        # í„±ëª©ê° ê³„ì‚° (3ì ìœ¼ë¡œ ì´ë£¨ëŠ” ê°ë„)
        angle = self.calculate_angle_3points(neck_bottom, chin, neck_front)
        return angle
    
    def calculate_angle_3points(self, p1, p2, p3):
        """3ê°œ ì ìœ¼ë¡œ ì´ë£¨ëŠ” ê°ë„ ê³„ì‚° (p2ê°€ ê¼­ì§“ì )"""
        import math
        
        x1, y1 = p1
        x2, y2 = p2  # ê¼­ì§“ì 
        x3, y3 = p3
        
        # ë²¡í„° ê³„ì‚°
        v1 = (x1 - x2, y1 - y2)  # p2ì—ì„œ p1ë¡œì˜ ë²¡í„°
        v2 = (x3 - x2, y3 - y2)  # p2ì—ì„œ p3ë¡œì˜ ë²¡í„°
        
        # ë²¡í„° í¬ê¸° ê³„ì‚°
        len1 = math.sqrt(v1[0]**2 + v1[1]**2)
        len2 = math.sqrt(v2[0]**2 + v2[1]**2)
        
        if len1 == 0 or len2 == 0:
            return None
        
        # ë‚´ì  ê³„ì‚°
        dot_product = v1[0] * v2[0] + v1[1] * v2[1]
        
        # ì½”ì‚¬ì¸ ê°’ ê³„ì‚° (-1 ~ 1 ë²”ìœ„ë¡œ í´ë¦¬í•‘)
        cos_angle = max(-1, min(1, dot_product / (len1 * len2)))
        
        # ë¼ë””ì•ˆì„ ë„(degree)ë¡œ ë³€í™˜
        angle_rad = math.acos(cos_angle)
        angle_deg = math.degrees(angle_rad)
        
        return angle_deg
    
    def calculate_jaw_angle_improved(self, ear_point, jaw_corner, jaw_mid):
        """ê°œì„ ëœ í•˜ì•…ê° ê³„ì‚° - ìˆ˜ì§ì„  ê¸°ì¤€ìœ¼ë¡œ í„±ì„  ê°ë„ ì¸¡ì •"""
        import math
        
        # ìˆ˜ì§ì„  ë°©í–¥ ë²¡í„° (ìœ„ì—ì„œ ì•„ë˜ë¡œ)
        vertical_vector = (0, 1)
        
        # í„±ì„  ë°©í–¥ ë²¡í„° (í„± ëª¨ì„œë¦¬ì—ì„œ í„± ì¤‘ê°„ìœ¼ë¡œ)
        jaw_vector = (jaw_mid[0] - jaw_corner[0], jaw_mid[1] - jaw_corner[1])
        
        # ë²¡í„° í¬ê¸° ê³„ì‚°
        jaw_length = math.sqrt(jaw_vector[0]**2 + jaw_vector[1]**2)
        
        if jaw_length == 0:
            return None
        
        # í„±ì„  ë²¡í„° ì •ê·œí™”
        jaw_unit = (jaw_vector[0] / jaw_length, jaw_vector[1] / jaw_length)
        
        # ìˆ˜ì§ì„ ê³¼ í„±ì„  ì‚¬ì´ì˜ ë‚´ì  ê³„ì‚°
        dot_product = vertical_vector[0] * jaw_unit[0] + vertical_vector[1] * jaw_unit[1]
        
        # ì½”ì‚¬ì¸ ê°’ í´ë¦¬í•‘ (-1 ~ 1)
        cos_angle = max(-1, min(1, dot_product))
        
        # ê°ë„ ê³„ì‚° (ë¼ë””ì•ˆ â†’ ë„)
        angle_rad = math.acos(abs(cos_angle))
        angle_deg = math.degrees(angle_rad)
        
        # í•˜ì•…ê°ì€ ë³´í†µ 90ë„ì—ì„œ ì‹œì‘í•˜ì—¬ 180ë„ì— ê°€ê¹Œì›Œì§ˆìˆ˜ë¡ ë‘”ê°
        # ì‹¤ì œ í•˜ì•…ê°ìœ¼ë¡œ ë³€í™˜ (90ë„ + ê³„ì‚°ëœ ê°ë„)
        gonial_angle = 90 + angle_deg
        
        return gonial_angle
    
    
    def calculate_lifting_score(self, gonial_angle, cervicomental_angle):
        """ë¦¬í”„íŒ… íš¨ê³¼ë¥¼ ë°˜ì˜í•œ í„± ì ìˆ˜ ê³„ì‚° (ë‚ ì¹´ë¡œìš¸ìˆ˜ë¡ ë†’ì€ ì ìˆ˜)"""
        
        # 1. í•˜ì•…ê° ì ìˆ˜ ê³„ì‚° (90-120ë„ê°€ ì´ìƒì , ì‘ì„ìˆ˜ë¡ Vë¼ì¸)
        # ì ìˆ˜ ë²”ìœ„: 90ë„=100ì , 120ë„=80ì , 140ë„=20ì , 150ë„ ì´ìƒ=0ì 
        if gonial_angle <= 90:
            gonial_score = 100
        elif gonial_angle <= 120:
            gonial_score = 100 - ((gonial_angle - 90) * 20 / 30)  # 90-120ë„: 100-80ì 
        elif gonial_angle <= 140:
            gonial_score = 80 - ((gonial_angle - 120) * 60 / 20)   # 120-140ë„: 80-20ì 
        else:
            gonial_score = max(0, 20 - ((gonial_angle - 140) * 20 / 10))  # 140ë„ ì´ìƒ: 20-0ì 
        
        # 2. í„±ëª©ê° ì ìˆ˜ ê³„ì‚° (100-120ë„ê°€ ì´ìƒì , ì„ ëª…í• ìˆ˜ë¡ ë†’ì€ ì ìˆ˜)
        # ì ìˆ˜ ë²”ìœ„: 110ë„=100ì , 105ë„=90ì , 90ë„=60ì , 80ë„ ì´í•˜=40ì 
        if 105 <= cervicomental_angle <= 115:
            cervico_score = 100
        elif 100 <= cervicomental_angle <= 120:
            cervico_score = 90 - abs(cervicomental_angle - 110) * 2
        elif 90 <= cervicomental_angle <= 130:
            cervico_score = 70 - abs(cervicomental_angle - 110) * 1.5
        else:
            cervico_score = max(40, 70 - abs(cervicomental_angle - 110) * 2)
        
        # 3. ìµœì¢… ë¦¬í”„íŒ… ì ìˆ˜ (ê°€ì¤‘í‰ê· : í•˜ì•…ê° 70%, í„±ëª©ê° 30%)
        lifting_score = gonial_score * 0.7 + cervico_score * 0.3
        
        return max(0, min(100, lifting_score))
    
    def display_jaw_angles_score(self, gonial_angle, cervicomental_angle, lifting_score):
        """í•˜ì•…ê°ê³¼ í„±ëª©ê° ì ìˆ˜ë¥¼ í™”ë©´ì— í‘œì‹œ (í„±ê³¼ ì…ìˆ  ì¤‘ê°„ ìœ„ì¹˜)"""
        # í„± ìµœí•˜ë‹¨ (152ë²ˆ ëœë“œë§ˆí¬)ê³¼ ì…ìˆ  í•˜ë‹¨ (18ë²ˆ ëœë“œë§ˆí¬) ì¤‘ê°„ ì§€ì  ê³„ì‚°
        jaw_bottom = self.get_landmark_coordinates(152)  # í„± ìµœí•˜ë‹¨
        lip_bottom = self.get_landmark_coordinates(18)   # ì•„ë˜ì…ìˆ  í•˜ë‹¨
        
        if not all([jaw_bottom, lip_bottom]):
            return
        
        # í„±ê³¼ ì…ìˆ ì˜ ì¤‘ê°„ ì§€ì  ê³„ì‚°
        center_x = (jaw_bottom[0] + lip_bottom[0]) / 2
        center_y = (jaw_bottom[1] + lip_bottom[1]) / 2
        
        # í™”ë©´ ì¢Œí‘œë¡œ ë³€í™˜
        display_point = self.image_to_screen_coords(center_x, center_y)
        
        if display_point:
            # ë©”ì¸ í„± ê³¡ë¥  ì ìˆ˜ í‘œì‹œ (ë¹¨ê°„ìƒ‰ í…ìŠ¤íŠ¸)
            self.canvas.create_text(
                display_point[0], display_point[1] - 10,
                text=f"í„±ê³¡ë¥  {lifting_score:.0f}ì ", anchor="center",
                fill="red", font=("Arial", 12, "bold"), tags="jaw_curvature"
            )
            
            # ì„¸ë¶€ ê°ë„ ì •ë³´ í‘œì‹œ (ë” í° ê¸€ì”¨, í°ìƒ‰)
            self.canvas.create_text(
                display_point[0], display_point[1] + 8,
                text=f"í•˜ì•…ê°{gonial_angle:.0f}Â° í„±ëª©ê°{cervicomental_angle:.0f}Â°", 
                anchor="center", fill="white", font=("Arial", 11, "bold"), tags="jaw_curvature"
            )

    def show_score_calculation_details(self, current_ratios):
        """ê° ì ìˆ˜ ê³„ì‚° ê³¼ì •ì„ ìƒì„¸íˆ ì‹œê°í™”"""
        if self.face_landmarks is None:
            print("ì–¼êµ´ì´ ê²€ì¶œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
            return
            
        # ê¸°ì¡´ í‘œì‹œ ì œê±°
        self.canvas.delete("calculation_details")
        self.canvas.delete("calculation_lines")
        
        print("ì ìˆ˜ ê³„ì‚° ê³¼ì •ì„ ìƒì„¸íˆ í‘œì‹œí•©ë‹ˆë‹¤...")
        
        try:
            # ê° ë¶€ìœ„ë³„ ìƒì„¸ ê³„ì‚° í‘œì‹œ
            self.show_forehead_score_detail(current_ratios)
            self.show_mouth_score_detail(current_ratios)
            self.show_eye_spacing_score_detail(current_ratios)
            
            # 20ì´ˆ í›„ ìë™ ì œê±°
            self.root.after(20000, lambda: [
                self.canvas.delete("calculation_details"),
                self.canvas.delete("calculation_lines")
            ])
            print("ì ìˆ˜ ê³„ì‚° ìƒì„¸ ì •ë³´ê°€ 20ì´ˆê°„ í‘œì‹œë©ë‹ˆë‹¤.")
            
        except Exception as e:
            print(f"ì ìˆ˜ ê³„ì‚° ìƒì„¸ í‘œì‹œ ì¤‘ ì˜¤ë¥˜: {str(e)}")
    
    def show_forehead_score_detail(self, current_ratios):
        """ì´ë§ˆ(ì „ì²´ ì–¼êµ´ ë¹„ìœ¨) ì ìˆ˜ ê³„ì‚° ìƒì„¸"""
        if "ì „ì²´_ì–¼êµ´_ë¹„ìœ¨" not in current_ratios:
            return
            
        face_top = self.get_landmark_coordinates(10)
        face_bottom = self.get_landmark_coordinates(152)
        face_left = self.get_landmark_coordinates(234)
        face_right = self.get_landmark_coordinates(454)
        
        if all([face_top, face_bottom, face_left, face_right]):
            # ì‹¤ì œ ì¸¡ì •ê°’
            face_height = self.calculate_distance(face_top, face_bottom)
            face_width = self.calculate_distance(face_left, face_right)
            current_ratio = current_ratios["ì „ì²´_ì–¼êµ´_ë¹„ìœ¨"]
            ideal_ratio = self.FACE_GOLDEN_RATIOS["ì „ì²´_ì–¼êµ´_ë¹„ìœ¨"]
            
            # ì ìˆ˜ ê³„ì‚°
            deviation = abs(current_ratio - ideal_ratio)
            score = max(0, 100 - (deviation / ideal_ratio * 100))
            
            # í™”ë©´ ì¢Œí‘œ
            top_screen = self.image_to_screen_coords(face_top[0], face_top[1])
            left_screen = self.image_to_screen_coords(face_left[0], face_left[1])
            
            if top_screen and left_screen:
                # ì¸¡ì • ì˜ì—­ ê°•ì¡°
                self.draw_bidirectional_arrow(
                    top_screen[0], top_screen[1],
                    self.image_to_screen_coords(face_bottom[0], face_bottom[1])[0], 
                    self.image_to_screen_coords(face_bottom[0], face_bottom[1])[1],
                    color="#FF6B6B", width=4, arrow_size=12
                )
                
                mid_y = (top_screen[1] + self.image_to_screen_coords(face_bottom[0], face_bottom[1])[1]) / 2
                self.draw_bidirectional_arrow(
                    left_screen[0], mid_y,
                    self.image_to_screen_coords(face_right[0], face_right[1])[0], mid_y,
                    color="#FF6B6B", width=4, arrow_size=12
                )
                
                # ìƒì„¸ ì •ë³´ ë°•ìŠ¤
                info_x = left_screen[0] - 200
                info_y = top_screen[1] + 50
                
                self.canvas.create_rectangle(
                    info_x, info_y, info_x + 180, info_y + 120,
                    fill="white", outline="#FF6B6B", width=3, tags="calculation_details"
                )
                
                lines = [
                    "ğŸ”´ ì´ë§ˆ ì ìˆ˜ ê³„ì‚°",
                    f"ì–¼êµ´ ì„¸ë¡œ: {face_height:.1f}px",
                    f"ì–¼êµ´ ê°€ë¡œ: {face_width:.1f}px", 
                    f"í˜„ì¬ ë¹„ìœ¨: {current_ratio:.3f}",
                    f"ì´ìƒ ë¹„ìœ¨: {ideal_ratio:.3f}",
                    f"í¸ì°¨: {deviation:.3f}",
                    f"ìµœì¢… ì ìˆ˜: {score:.1f}%"
                ]
                
                for i, line in enumerate(lines):
                    color = "#FF6B6B" if i == 0 else "#000000"
                    font = ("Arial", 8, "bold") if i == 0 else ("Arial", 7)
                    self.canvas.create_text(
                        info_x + 5, info_y + 10 + i*15,
                        text=line, anchor="w", fill=color, font=font,
                        tags="calculation_details"
                    )
    