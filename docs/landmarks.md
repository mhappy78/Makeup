# Face Simulator 랜드마크 가이드

## 개요

Face Simulator는 MediaPipe Face Mesh의 468개 3D 얼굴 랜드마크를 기반으로 하여, 얼굴의 주요 특징들을 해부학적으로 정확하게 표시합니다. 각 랜드마크 그룹은 색상으로 구분되어 시각적으로 쉽게 식별할 수 있습니다.

## MediaPipe Face Mesh 시스템

MediaPipe Face Mesh는 단일 카메라 입력만으로 실시간으로 468개의 3D 얼굴 랜드마크를 추정하는 ML 솔루션입니다.

- **총 랜드마크 수**: 468개 (refine_landmarks=True 시 478개)
- **좌표 시스템**: x, y는 이미지 크기로 정규화된 [0.0, 1.0], z는 머리 중심을 원점으로 하는 깊이값
- **실시간 처리**: 모바일 디바이스에서도 실시간 추적 가능

## 랜드마크 그룹별 상세 정보

### 👀 눈 (Eyes) - 녹색 (#00ff00)

눈의 윤곽과 세부 구조를 나타내는 랜드마크입니다.

**왼쪽 눈 (17개)**:
```
[33, 7, 163, 144, 145, 153, 154, 155, 133, 173, 157, 158, 159, 160, 161, 246]
```

**오른쪽 눈 (16개)**:
```
[362, 382, 381, 380, 374, 373, 390, 249, 263, 466, 388, 387, 386, 385, 384, 398]
```

- **주요 포인트**: 
  - 33: 왼쪽 눈 안쪽 모서리
  - 362: 오른쪽 눈 안쪽 모서리
  - 133: 왼쪽 눈 바깥쪽 모서리
  - 263: 오른쪽 눈 바깥쪽 모서리

### 👁️ 눈동자 (Iris) - 밝은청록색 (#00ccff)

눈동자(홍채)의 윤곽을 나타내는 특별한 랜드마크입니다. MediaPipe에서 `refine_landmarks=True` 옵션을 사용할 때만 활성화되며, 기본 468개 랜드마크에 추가로 제공됩니다.

#### 👁️ 왼쪽 눈동자 (4개):
```
랜드마크: [474, 475, 476, 477]
```

#### 👁️ 오른쪽 눈동자 (4개):
```
랜드마크: [469, 470, 471, 472]
```

**특징:**
- **총 랜드마크 수**: 8개 (좌우 각 4개)
- **인덱스 범위**: 469-477 (기본 468개 이후 추가)
- **활성화 조건**: MediaPipe FaceMesh에서 `refine_landmarks=True` 설정 필요
- **용도**: 시선 추적, 눈동자 확대/축소, 컬러 콘택트 렌즈 효과 등

### 👆👇 눈꺼풀 (Eyelids) - 연한녹색 계열

눈 주변의 상하 눈꺼풀 라인을 정밀하게 나타내는 랜드마크입니다. 눈의 기본 윤곽과는 별도로 눈꺼풀의 세밀한 움직임과 형태를 추적할 수 있습니다.

#### 👆 상 눈꺼풀 (Upper Eyelids) - 연한녹색 (#66ff66)

**왼쪽 상 눈꺼풀 (9개)**:
```
랜드마크: [226, 247, 30, 29, 27, 28, 56, 190, 243]
```

**오른쪽 상 눈꺼풀 (8개)**:
```
랜드마크: [463, 414, 286, 258, 257, 260, 467, 446]
```

#### 👇 하 눈꺼풀 (Lower Eyelids) - 더 연한녹색 (#99ff99)

**왼쪽 하 눈꺼풀 (9개)**:
```
랜드마크: [226, 25, 110, 24, 23, 22, 26, 112, 243]
```

**오른쪽 하 눈꺼풀 (9개)**:
```
랜드마크: [463, 341, 256, 252, 253, 254, 339, 255, 446]
```

**특징:**
- **총 랜드마크 수**: 35개 (상 눈꺼풀 17개 + 하 눈꺼풀 18개)
- **최적화된 구조**: 불필요한 중복 랜드마크 제거로 더 정확한 윤곽 표현
- **제거된 랜드마크**: 상측 130, 259 / 하측 130, 359 (중복 및 부정확 위치)
- **연결점**: 226, 243 (왼쪽), 463, 446 (오른쪽)
- **용도**: 눈 화장 시뮬레이션, 눈꺼풀 수술 시뮬레이션, 표정 분석

### 🔍 눈꺼풀 주변라인 (Eyelid Surrounding Lines) - 매우 연한녹색 계열

눈꺼풀 바깥쪽 주변 영역의 라인을 나타내는 랜드마크입니다. 기본 눈꺼풀보다 더 넓은 범위의 눈 주변 구조를 표현합니다.

#### 🔍 상 주변라인 (Upper Surrounding Lines) - 매우 연한녹색 (#ccffcc)

**왼쪽 상 주변라인 (9개)**:
```
랜드마크: [35, 113, 225, 224, 223, 222, 221, 189, 244]
```

**오른쪽 상 주변라인 (9개)**:
```
랜드마크: [465, 413, 441, 442, 443, 444, 445, 342, 265]
```

#### 🔍 하 주변라인 (Lower Surrounding Lines) - 아주 연한녹색 (#e6ffe6)

**왼쪽 하 주변라인 (9개)**:
```
랜드마크: [35, 31, 228, 229, 230, 231, 232, 233, 244]
```

**오른쪽 하 주변라인 (9개)**:
```
랜드마크: [465, 453, 452, 451, 450, 449, 448, 261, 265]
```

**특징:**
- **총 랜드마크 수**: 36개 (상 주변라인 18개 + 하 주변라인 18개)
- **좌우 대칭**: 각각 9개씩 완전한 대칭 구조
- **연결점**: 35, 244 (왼쪽), 465, 265 (오른쪽)
- **확장 범위**: 기본 눈꺼풀보다 넓은 주변 영역 커버
- **용도**: 확장된 눈 화장 영역, 주름 분석, 넓은 범위 표정 추적

### 👃 코 (Nose) - 6개 그룹

코는 해부학적 구조에 따라 6개의 세부 그룹으로 나뉩니다.

#### 🔴 코끝 (Nose Tip) - 빨간색 (#ff0000)

코의 가장 앞쪽 끝 부분을 나타냅니다.

```
랜드마크: [1, 2]
```

- **1번**: 코끝의 최전방점
- **2번**: 코끝 하단

#### 🟠 코기둥 (Nose Bridge) - 주황빨강 (#ff4400)

코의 중앙 기둥 부분, 콧대를 형성합니다.

```
랜드마크: [4, 5, 6, 19, 94, 168, 195, 197]
```

- **4, 5, 6**: 코 기둥 상단
- **19**: 코 기둥 중간
- **94**: 콧구멍과 기둥 연결부
- **168, 195, 197**: 코 기둥 세부 윤곽

#### 🟡 콧볼 (Nose Wings) - 주황색 (#ff8800)

콧구멍 주변의 부풀린 부분과 코의 중앙 측면 윤곽을 포함합니다.

```
랜드마크: [45, 129, 64, 98, 97, 115, 220, 275, 278, 294, 326, 327, 344, 440]
```

**기존 콧볼 부분 (7개)**:
- **45, 220**: 콧볼 외곽
- **129**: 콧볼 중심부 (192에서 129로 수정)
- **64, 98, 97**: 콧구멍 주변
- **115**: 콧볼 하단

**통합된 코 측면 부분 (7개)**:
- **275, 440**: 코 측면 외곽
- **278, 344**: 코 측면 중간
- **294, 326, 327**: 코 측면 세부 윤곽

#### 🟨 코 측면 (Nose Sides) - 밝은황색 (#ffcc00)

코의 좌우 측면 윤곽을 통합한 그룹입니다.

```
랜드마크: [49, 209, 198, 236, 196, 122, 193, 279, 360, 420, 456, 419, 351, 417]
```

**왼쪽 측면 (7개)**:
- **49**: 좌측 콧볼 외곽
- **209, 198**: 좌측 코 윤곽선
- **236**: 좌측 코 상단
- **196, 122, 193**: 좌측 코 세부 구조

**오른쪽 측면 (7개)**:
- **279**: 우측 콧볼 외곽
- **360, 420**: 우측 코 윤곽선
- **456**: 우측 코 상단
- **419, 351, 417**: 우측 코 세부 구조

### 💋👄 입술 (Lips) - 2개 그룹

입술은 윗입술과 아래입술로 구분하여 독립적으로 제어할 수 있습니다.

#### 💋 윗입술 (Upper Lip) - 밝은빨강 (#ff3300)

윗입술의 완전한 윤곽선을 나타냅니다.

```
랜드마크: [61, 185, 40, 39, 37, 0, 267, 269, 270, 409, 291, 308, 415, 310, 312, 13, 82, 81, 80, 191, 78]
```

- **0**: 상순 중앙 최상단
- **13**: 상순 중앙 하단
- **61, 291**: 좌우 입꼬리 연결점
- **78, 308**: 입꼴리 내측
- **총 21개 랜드마크**

#### 👄 아래입술 (Lower Lip) - 주황색 (#ff6600)

아랫입술의 완전한 윤곽선을 나타냅니다.

```
랜드마크: [61, 146, 91, 181, 84, 17, 314, 405, 321, 375, 291, 308, 324, 402, 317, 14, 87, 178, 88, 95, 78]
```

- **17**: 하순 중앙 최하단
- **14**: 하순 중앙 상단
- **61, 291**: 좌우 입꼴리 연결점 (윗입술과 공유)
- **78, 308**: 입꼴리 내측 (윗입술과 공유)
- **총 21개 랜드마크**

**특징:**
- **독립적 가시성 제어**: 윗입술과 아래입술을 각각 선택적으로 표시/숨김 가능
- **색상 구분**: 윗입술(밝은빨강), 아래입술(주황색)으로 구분
- **공유 랜드마크**: 입꼬리 연결점 61, 291과 내측 78, 308은 양쪽에서 공유

### 🦴 턱선 (Jawline) - 파란색 (#0066ff)

얼굴의 기본 윤곽을 형성하는 턱선 랜드마크입니다.

```
랜드마크: [172, 136, 150, 149, 176, 148, 152, 377, 400, 378, 379, 365, 397, 288, 361, 323, 58, 132, 137]
```

- **172, 136**: 왼쪽 턱선 시작
- **323, 361**: 오른쪽 턱선 (원래 랜드마크)
- **137, 132, 58**: 왼쪽 턱선 (대칭 보완)
- **기존 175번(턱 끝) 제거**: 턱선 영역으로 이동

### 🦴 턱선 영역 (Jawline Area) - 밝은파란색 (#0088ff)

턱선을 포함한 확장된 턱 주변 전체 영역을 나타내는 랜드마크입니다.

```
랜드마크: [172, 136, 150, 149, 176, 148, 152, 377, 400, 378, 379, 365, 397, 288, 361, 323, 58, 132, 137,  # 기존 턱선
          123, 50, 207, 212, 202, 204, 194, 201, 200, 421, 418, 424, 422, 432, 427, 280, 352]  # 추가 영역
```

**특징:**
- **총 랜드마크 수**: 36개 (기존 턱선 19개 + 추가 영역 17개)
- **기존 턱선 포함**: 기본 턱선 윤곽의 모든 포인트 포함
- **확장 영역**: 턱 주변부, 볼 하단, 목 연결부까지 포함
- **용도**: 턱선 성형 시뮬레이션, 얼굴 윤곽 강화, 전체적인 얼굴형 분석

### 👄 입 주변 영역 (Mouth Area) - 연한주황색 (#ff9966)

입술 주변의 확장된 영역을 나타내는 랜드마크입니다.

```
랜드마크: [167, 164, 393, 391, 322, 410, 287, 273, 335, 406, 313, 18, 83, 182, 106, 43, 57, 186, 92, 165]
```

**특징:**
- **총 랜드마크 수**: 20개
- **커버 영역**: 입술 둘레, 인중, 하순 아래, 구강 주변부
- **색상**: 연한주황색으로 기존 입술 그룹들과 구분
- **선 연결**: 랜드마크 간 선으로 연결하여 입 주변 윤곽을 명확히 표시
- **용도**: 입 주변 화장, 주름 분석, 구강 성형 시뮬레이션

### 👃 코 주변 영역 (Nose Area) - 연한황색 (#ffdd66)

코 주변의 확장된 영역을 나타내는 랜드마크입니다.

```
랜드마크: [55, 9, 285, 413, 464, 453, 350, 329, 266, 425, 426, 391, 393, 164, 167, 165, 206, 205, 36, 100, 121, 233, 243, 189]
```

**특징:**
- **총 랜드마크 수**: 24개
- **커버 영역**: 코 전체, 비익, 인중, 코 양쪽 볼 연결부
- **색상**: 연한황색으로 기존 코 그룹들과 구분
- **용도**: 코 주변 화장, 코 성형 시뮬레이션, 확장된 코 영역 분석

### 😔 팔자주름 영역 (Nasolabial Folds) - 연보라색 계열

얼굴의 팔자주름(비순구) 영역을 좌우로 나누어 표시하는 랜드마크입니다.

#### 😔 좌측 팔자주름 (Left Nasolabial) - 연한보라색 (#cc99ff)

```
랜드마크: [126, 131, 49, 129, 165, 61, 181, 194, 204, 202, 212, 216, 36, 142]
```

**특징:**
- **총 랜드마크 수**: 14개
- **커버 영역**: 좌측 코 옆에서 입꼬리까지의 주름 라인
- **주요 포인트**: 126(상단 시작), 61(입꼬리 연결), 181(중간부), 142(볼 연결부)
- **개선점**: 106→181 변경으로 더 정확한 주름 라인 표현

#### 😔 우측 팔자주름 (Right Nasolabial) - 밝은연보라색 (#dd99ff)

```
랜드마크: [355, 371, 266, 436, 432, 422, 424, 418, 405, 291, 391, 278, 360, 321, 363]
```

**특징:**
- **총 랜드마크 수**: 15개 (13개 → 15개)
- **커버 영역**: 우측 코 옆에서 입꼬리까지의 주름 라인
- **주요 포인트**: 355(상단 시작), 291(입꼬리 연결), 405(중간부), 371(볼 연결부)
- **개선점**: 335→405, 420→355, 91→191→291 변경 및 321, 363 추가로 더 정밀한 커버리지

**공통 특징:**
- **독립적 가시성 제어**: 좌우 팔자주름을 각각 선택적으로 표시/숨김 가능
- **색상 구분**: 좌측(연한보라), 우측(밝은연보라)로 구분
- **용도**: 팔자주름 분석, 주름 제거 시뮬레이션, 노화 분석, 표정 변화 추적

### 🤨 눈썹 주변 영역 (Eyebrow Area) - 중간보라색 (#bb77ff)

눈썹 주변의 확장된 영역을 나타내는 랜드마크입니다.

```
랜드마크: [139, 71, 68, 104, 69, 108, 151, 337, 299, 333, 298, 301, 383, 353, 260, 259, 257, 258, 286, 413, 417, 168, 193, 189, 56, 28, 27, 29, 30, 156]
```

**특징:**
- **총 랜드마크 수**: 30개
- **커버 영역**: 눈썹 위아래, 눈썹 양쪽 끝, 눈썹과 이마 연결부
- **색상**: 중간보라색으로 기존 눈썹과 구분
- **용도**: 눈썹 성형 시뮬레이션, 확장된 눈썹 화장, 이마-눈썹 경계 분석

### 🤨 눈썹 (Eyebrows) - 보라색 (#9900ff)

눈썹의 형태를 나타내는 랜드마크입니다.

**왼쪽 눈썹 (10개)**:
```
[55, 107, 66, 105, 63, 70, 46, 53, 52, 65]
```

**오른쪽 눈썹 (10개)**:
```
[285, 336, 296, 334, 293, 300, 276, 283, 282, 295]
```

### 🏛️ 이마 (Forehead) - 연한살색 (#ffdd99)

이마 전체 영역을 나타내는 랜드마크입니다.

```
랜드마크: [10, 338, 297, 332, 284, 251, 301, 293, 334, 296, 336, 9, 107, 66, 105, 63, 71, 21, 54, 103, 67, 109]
```

**특징:**
- **총 랜드마크 수**: 22개
- **커버 영역**: 이마 전체 면적 (헤어라인 하단부터 눈썹 상단까지)
- **중앙부**: 10, 9 (이마 중심선)
- **좌우 영역**: 338, 297, 332, 284, 251 (우측), 301, 293, 334, 296, 336 (좌측)
- **하단부**: 107, 66, 105, 63, 71 (눈썹 연결부)
- **용도**: 주름 분석, 이마 화장, 표정 변화 추적

### 👁️‍🗨️ 미간 (Glabella) - 진한살색 (#ffcc88)

두 눈썹 사이의 미간 영역을 나타내는 랜드마크입니다.

```
랜드마크: [107, 9, 336, 285, 417, 168, 193, 55]
```

**특징:**
- **총 랜드마크 수**: 8개
- **중앙부**: 9 (미간 중심점)
- **눈썹 연결**: 107, 55 (좌우 눈썹 내측)
- **코 연결부**: 168, 193 (코 상단 연결)
- **측면부**: 336, 285, 417 (미간 주변)
- **용도**: 찌푸림 분석, 미간 주름 추적, 표정 인식

### 😊 광대 (Cheekbones) - 분홍색 (#ff0099)

광대뼈 부위의 랜드마크입니다.

**왼쪽 광대 (8개)**:
```
[116, 117, 118, 119, 120, 121, 126, 142]
```

**오른쪽 광대 (8개)**:
```
[345, 346, 347, 348, 349, 350, 355, 371]
```

### 😶 볼 영역 (Cheek Area) - 밝은분홍색 (#ff6699)

얼굴의 볼 부분 전체 면적을 나타내는 랜드마크입니다. 광대뼈를 포함한 더 넓은 볼 영역을 커버합니다.

**왼쪽 볼 영역 (14개)**:
```
[116, 117, 118, 119, 120, 121, 126, 142, 36, 205, 147, 187, 123, 50]
```

**오른쪽 볼 영역 (14개)**:
```
[345, 346, 347, 348, 349, 350, 355, 371, 266, 425, 376, 411, 352, 280]
```

**특징:**
- **총 랜드마크 수**: 28개 (좌우 각 14개)
- **포함 요소**: 광대뼈 + 볼 주변부 + 측면 윤곽 + 볼 중앙부
- **겹치는 부분**: 광대뼈 랜드마크와 일부 중복 (116-142, 345-371)
- **추가 영역**: 36, 205, 147, 187, 123, 50 (왼쪽), 266, 425, 376, 411, 352, 280 (오른쪽)
- **제거된 랜드마크**: 206, 207, 213, 192 (왼쪽), 426, 427, 436, 416 (오른쪽)
- **볼 중앙부**: 50 (왼쪽), 280 (오른쪽) - 블러쉬 중심점
- **용도**: 블러쉬 적용, 볼 윤곽 분석, 얼굴형 판단, 화장 영역 설정

## 사용자 컨트롤

### 크기 조절

#### 점 크기 (Point Size)
- **범위**: 1px ~ 8px
- **기본값**: 3px
- **효과**: 랜드마크 점의 크기 조절

#### 번호 크기 (Font Size)
- **범위**: 3pt ~ 10pt
- **기본값**: 5pt
- **효과**: 랜드마크 번호 텍스트 크기 조절

### 줌 반응형
- 모든 랜드마크와 번호는 줌 레벨에 비례하여 크기가 조절됩니다
- 최소 크기 제한으로 너무 작아지지 않도록 보장됩니다

## 기술 세부사항

### 좌표 변환
```python
# 이미지 좌표를 화면 좌표로 변환
screen_x = img_x * scale_factor * zoom_factor + offset_x + pan_x
screen_y = img_y * scale_factor * zoom_factor + offset_y + pan_y

# 크기 조절 (사용자 설정 + 줌 고려)
point_size = max(1, int(landmark_point_size * zoom_factor))
font_size = max(3, int(landmark_font_size * zoom_factor))
```

### MediaPipe 호환성
```python
import mediapipe as mp

# MediaPipe Face Mesh 초기화 (눈동자 포함)
mp_face_mesh = mp.solutions.face_mesh

# 얼굴 검출 (refine_landmarks=True로 눈동자 활성화)
with mp_face_mesh.FaceMesh(refine_landmarks=True) as face_mesh:
    results = face_mesh.process(image)
    if results.multi_face_landmarks:
        landmarks = results.multi_face_landmarks[0].landmark
        # 총 478개 랜드마크 (468 + 눈동자 10개)
        
# 눈동자 전용 상수 사용
iris_connections = mp.solutions.face_mesh.FACEMESH_IRISES
left_iris = mp.solutions.face_mesh.FACEMESH_LEFT_IRIS  # [474, 475, 476, 477]
right_iris = mp.solutions.face_mesh.FACEMESH_RIGHT_IRIS  # [469, 470, 471, 472]
```

## 개발 히스토리

### v1.0 - 기본 랜드마크
- MediaPipe 기본 그룹 사용
- 단순한 색상 구분

### v2.0 - 입술 정밀화
- enhanced_makeup_utils.py의 정밀한 LIP_UPPER, LIP_LOWER 적용
- 상하순 색상 구분

### v3.0 - 턱선 대칭화
- 좌우 대칭 랜드마크 적용 (323↔137, 361↔132, 288↔58)

### v4.0 - 코 상세화
- MediaPipe FACEMESH_NOSE 완전 적용 (24→38개)
- 코 부위별 6개 그룹으로 세분화
- 48→192→129 교체, 좌우측면 그룹 추가
- 174, 188 제거로 정확도 향상
- 오른쪽 눈썹에 282 랜드마크 추가

### v4.1 - 눈동자 추가
- MediaPipe 눈동자 랜드마크 추가 (총 8개)
- 좌우 눈동자 별도 그룹화
- refine_landmarks=True 지원
- 총 랜드마크 수: 478개 (468 + 눈동자 8개 + 추가 2개)

### v4.2 - 눈꺼풀 추가
- 상하 눈꺼풀 랜드마크 추가 (총 40개)
- 좌우 대칭 구조로 정밀한 눈꺼풀 라인 표현
- 연한녹색 계열로 눈 영역과 구분
- 눈 화장 및 성형 시뮬레이션 지원 강화
- 왼쪽 눈꺼풀 랜드마크 정밀화 (266→226, 100→110)

### v4.3 - 눈꺼풀 주변라인 추가
- 눈꺼풀 주변라인 랜드마크 추가 (총 36개)
- 기본 눈꺼풀보다 확장된 주변 영역 커버
- 매우 연한녹색 계열로 층차적 색상 구분
- 확장된 눈 화장 영역 및 주름 분석 지원

### v4.4 - 볼 영역 추가
- 얼굴의 볼 부분 면적 랜드마크 추가 (총 32개)
- 광대뼈를 포함한 전체 볼 영역 커버
- 밝은분홍색(#ff6699)으로 광대뼈와 구분
- 블러쉬 적용, 볼 윤곽 분석, 얼굴형 판단 지원
- makeup_engine.py와 동일한 좌표 체계 적용

### v4.5 - 볼 영역 정제
- 볼 영역 랜드마크 수량 조정 (32개 → 24개)
- 정확도 향상을 위한 특정 랜드마크 제거
- 왼쪽 볼: 206, 207, 213, 192 제거 (16개 → 12개)
- 오른쪽 볼: 426, 427, 436, 416 제거 (16개 → 12개)
- 더 정밀한 볼 영역 표현을 위한 최적화

### v4.6 - 볼 영역 확장
- 볼 영역에 중앙부 및 추가 영역 랜드마크 보강 (24개 → 28개)
- 왼쪽 볼: 123, 50 추가 (12개 → 14개)
- 오른쪽 볼: 352, 280 추가 (12개 → 14개)
- 볼 중앙부 블러쉬 포인트 50, 280 추가로 화장 정확도 향상
- 더 완성도 높은 볼 영역 커버리지 확보

### v4.7 - 콧볼 영역 통합
- 기존 "코 중앙측면" 그룹을 "콧볼" 그룹으로 통합 (7개 + 7개 = 14개)
- 콧볼 가시성 제어 문제 수정 (체크 해제 시에도 표시되던 문제 해결)
- 콧볼 랜드마크: [45, 129, 64, 98, 97, 115, 220, 275, 278, 294, 326, 327, 344, 440]
- 더 직관적인 코 영역 분류 체계 구축

### v4.8 - 코 측면 통합 및 입술 분리
- 코 좌측면/우측면을 "코 측면"으로 통합 (7개 + 7개 = 14개)
- 입술을 윗입술/아래입술로 분리하여 독립적 가시성 제어 지원
- 코 측면 랜드마크: [49, 209, 198, 236, 196, 122, 193, 279, 360, 420, 456, 419, 351, 417]
- 윗입술(21개), 아래입술(21개) 독립 제어로 더 정밀한 입술 분석 가능
- 더 직관적이고 실용적인 랜드마크 그룹 분류 완성

### v4.9 - 이마 및 미간 영역 추가
- 이마 영역 랜드마크 추가 (22개): 전체 이마 면적 커버
- 미간 영역 랜드마크 추가 (8개): 두 눈썹 사이 정밀 분석
- 이마 랜드마크: [10, 338, 297, 332, 284, 251, 301, 293, 334, 296, 336, 9, 107, 66, 105, 63, 71, 21, 54, 103, 67, 109]
- 미간 랜드마크: [107, 9, 336, 285, 417, 168, 193, 55]
- 얼굴 상단부 완전 커버리지 달성 - 주름 분석, 표정 인식, 화장 영역 확장
- 총 18개 랜드마크 그룹으로 MediaPipe 468 포인트 완전 활용

### v4.10 - 영향 반경 범위 확장
- 영향 반경 최대값을 15%에서 50%로 확장
- 더 넓은 범위의 이미지 변형 작업 지원
- 대용량 이미지에서도 충분한 변형 영역 확보 가능
- 사용자 요청에 따른 실용성 향상

### v4.11 - 턱선 영역 세분화 및 확장
- 기존 턱선에서 175번(턱 끝) 랜드마크 제거 (19개 → 18개)
- 새로운 "턱선 영역" 그룹 추가 (총 36개)
- 턱선 영역: 기존 턱선 + 확장 영역 (123, 50, 207, 212, 202, 204, 194, 201, 200, 421, 418, 424, 422, 432, 427, 280, 352)
- 턱선과 턱선 영역의 독립적 가시성 제어 지원
- 더 정밀한 턱 주변부 분석 및 성형 시뮬레이션 가능

### v4.12 - 주변 영역 그룹 추가
- 새로운 "입 주변 영역" 그룹 추가 (20개)
- 입 주변 영역: [167, 164, 393, 391, 322, 410, 287, 273, 335, 406, 313, 18, 83, 182, 106, 43, 57, 186, 92, 165]
- 새로운 "코 주변 영역" 그룹 추가 (24개)
- 코 주변 영역: [55, 9, 285, 413, 464, 453, 350, 329, 266, 425, 426, 391, 393, 164, 167, 165, 206, 205, 36, 100, 121, 233, 243, 189]
- 확장된 주변 영역 분석으로 더 정밀한 얼굴 특징 시뮬레이션 지원
- 총 21개 랜드마크 그룹으로 MediaPipe 468 포인트 활용 극대화

### v4.13 - 팔자주름 영역 추가
- 새로운 "좌측 팔자주름" 그룹 추가 (14개)
- 좌측 팔자주름: [126, 131, 49, 129, 165, 61, 106, 194, 204, 202, 212, 216, 36, 142]
- 새로운 "우측 팔자주름" 그룹 추가 (13개)
- 우측 팔자주름: [420, 371, 266, 436, 432, 422, 424, 418, 335, 91, 391, 278, 360]
- 좌우 팔자주름 독립적 가시성 제어로 비대칭 분석 가능
- 주름 분석, 노화 연구, 표정 변화 추적 등 특화 기능 지원
- 총 23개 랜드마크 그룹으로 확장

### v4.14 - 눈썹 주변 영역 추가
- 새로운 "눈썹 주변 영역" 그룹 추가 (30개)
- 눈썹 주변 영역: [139, 71, 68, 104, 69, 108, 151, 337, 299, 333, 298, 301, 383, 353, 260, 259, 257, 258, 286, 413, 417, 168, 193, 189, 56, 28, 27, 29, 30, 156]
- 눈썹과 눈썹 주변 영역의 독립적 가시성 제어 지원
- 확장된 눈썹 화장, 눈썹 성형 시뮬레이션 등 정밀 분석 가능
- 총 24개 랜드마크 그룹으로 확장하여 MediaPipe 활용 극대화

### v4.15 - 눈꺼풀 랜드마크 최적화
- 상 눈꺼풀에서 중복 랜드마크 130, 259 제거 (20개 → 17개)
- 하 눈꺼풀에서 중복 랜드마크 130, 359 제거 (20개 → 18개)
- 왼쪽 상 눈꺼풀: 10개 → 9개, 오른쪽 상 눈꺼풀: 10개 → 8개
- 왼쪽 하 눈꺼풀: 10개 → 9개, 오른쪽 하 눈꺼풀: 10개 → 9개
- 불필요한 중복 제거로 더 정확하고 깔끔한 눈꺼풀 윤곽 표현
- 총 눈꺼풀 랜드마크 수: 40개 → 35개로 최적화

### v4.16 - 팔자주름 영역 정밀화
- 좌측 팔자주름: 106→181 변경으로 더 정확한 주름 라인 표현
- 우측 팔자주름 확장 및 정밀화: 335→405, 420→355, 91→191→291 변경 및 321, 363 추가 (13개 → 15개)
- 좌측: [126, 131, 49, 129, 165, 61, 181, 194, 204, 202, 212, 216, 36, 142]
- 우측: [355, 371, 266, 436, 432, 422, 424, 418, 405, 291, 391, 278, 360, 321, 363]
- 팔자주름 분석 정확도 향상 및 더 정밀한 주름 커버리지 구현
- 총 팔자주름 랜드마크: 27개 → 29개로 확장

### v4.17 - 입 주변 영역 선 연결 기능 추가
- 입 주변 영역 랜드마크를 선으로 연결하여 윤곽 시각화 개선
- draw_mouth_area_lines() 함수 구현으로 20개 랜드마크 순차 연결
- 닫힌 다각형 형태로 입 주변 영역의 경계를 명확히 표시
- 줌 레벨에 따른 선 두께 자동 조정으로 시각적 일관성 유지
- 입 주변 영역 체크박스와 연동하여 선택적 표시 가능
- 더 직관적이고 명확한 입 주변 영역 분석 도구 완성

### v5.0 - 새로운 랜드마크 그룹 및 부드러운 곡선 구현 (2025-08-13)

#### 랜드마크 크기 조정 및 UI 개선
- 랜드마크 표시 원 크기를 50%로 축소하여 더 정밀한 시각화 구현
- UI 레이아웃 최적화: 노트북 높이 950px, 토글 영역 300px로 조정
- 스크롤 문제 해결: 부위별 표시 영역 상하 양방향 스크롤 지원
- 마우스 휠 바인딩 충돌 해결로 부드러운 줌/스크롤 경험 제공

#### 새로운 복합 랜드마크 그룹 추가 (3개)

**하꺼풀영역 (eyelid_lower_area) - 밝은파란색 (#66ccff)**
```
총 27개 랜드마크: 하꺼풀 + 눈 하단 영역 결합
- 하꺼풀: [226, 247, 30, 29, 27, 28, 56, 190, 243, 463, 414, 286, 258, 257, 259, 260, 467, 446]
- 눈 하단: [33, 7, 163, 144, 145, 153, 154, 155, 133, 362, 382, 381, 380, 374, 373, 390, 249, 359]
- 우측 눈에 359 랜드마크 추가로 대칭성 향상
- 특별 연결 규칙: 463-362, 359-446, 226-33, 133-243 연결 적용
```

**상주변영역 (eyelid_upper_surround_area) - 밝은주황색 (#ffcc99)**
```
총 35개 랜드마크: 상꺼풀 + 상주변 영역 결합
- 상꺼풀: [226, 247, 30, 29, 27, 28, 56, 190, 243, 463, 414, 286, 258, 257, 260, 467, 446]
- 상주변: [35, 113, 225, 224, 223, 222, 221, 189, 244, 465, 413, 441, 442, 443, 444, 445, 342, 265]
- 확장된 눈 주변 영역으로 넓은 범위 메이크업 시뮬레이션 지원
```

**상꺼풀영역 (eyelid_upper_area) - 밝은주황색 (#ff9966)**
```
총 27개 랜드마크: 상꺼풀 + 눈 상단 영역 결합
- 상꺼풀: [226, 247, 30, 29, 27, 28, 56, 190, 243, 463, 414, 286, 258, 257, 260, 467, 446]
- 눈 상단: [33, 246, 161, 160, 159, 158, 157, 173, 133, 362, 398, 384, 385, 386, 387, 388, 466, 263, 359]
- 상꺼풀과 눈 윗부분의 완전한 통합 분석 영역
```

#### 혁신적인 부드러운 곡선 렌더링 시스템

**1단계: Tkinter smooth 옵션 실험**
- 기본 `create_line`의 `smooth=True`, `splinesteps` 옵션 적용
- 결과: 시각적 개선 효과 미미

**2단계: 카테인 롬 스플라인 구현**
```python
def _catmull_rom_interpolate(self, p0, p1, p2, p3, t):
    # 수학적 스플라인 공식 적용
    # P(t) = 0.5 * [(2*P1) + (-P0 + P2)*t + (2*P0 - 5*P1 + 4*P2 - P3)*t^2 + (-P0 + 3*P1 - 3*P2 + P3)*t^3]
```
- 10개 세그먼트당 카테인 롬 스플라인 보간점 생성
- 결과: 수학적으로 정확하나 시각적 효과 제한적

**3단계: 베지어 곡선 시스템 (최종 구현)**
```python
def _generate_bezier_curve_points(self, control_points, resolution=100):
    # 2차 베지어 곡선을 이용한 부드러운 곡선 생성
    
def _quadratic_bezier_points(self, p0, p1, p2, num_points=50):
    # B(t) = (1-t)²P₀ + 2(1-t)tP₁ + t²P₂ 공식 적용
```
- **해상도**: 100개 구간, 세그먼트당 50개 점으로 극도로 부드러운 곡선
- **적용 방식**: 많은 작은 선분을 연결하여 시각적으로 완전한 곡선 구현
- **결과**: 직선적이던 랜드마크 연결선이 자연스러운 곡선으로 변환

#### 영역 채우기 시스템 개발 및 제거

**투명 영역 채우기 구현 (임시)**
- `stipple` 패턴을 활용한 진짜 투명도 구현
- 투명도 슬라이더 (10%~80%) 및 영역 토글 버튼 추가
- 닫힌 랜드마크 영역을 투명한 색상으로 채우는 기능 완성

**문제 발생 및 해결**
- 눈 영역에서 173, 398, 362 세 점으로 이루어진 삼각형이 부자연스럽게 표시
- 해당 점들을 필터링하는 로직 구현 시도
- 지속적인 문제로 인해 **영역 채우기 기능 전체 삭제** 결정

**삭제된 구성요소**
- 투명 색상 생성 함수 (`_create_transparent_color`, `_draw_filled_area`)
- 영역 토글 버튼 및 투명도 조절 슬라이더
- 모든 polygon 채우기 관련 코드 및 "landmark_areas" 태그

#### 랜드마크 연결 시스템 고도화

**그룹별 전용 처리 함수**
- `_draw_eye_lines()`: 좌우 눈 분리 처리 및 닫힌 곡선 적용
- `_draw_circular_lines()`: 홍채 원형 처리 최적화
- `_draw_jawline_lines()`: 턱선 특별 연결 규칙 적용
- `_draw_eyebrow_lines()`: 눈썹 좌우 분리 및 대칭 처리
- `_draw_closed_polygon_lines()`: 닫힌 다각형 부드러운 곡선 처리

**부드러운 곡선 적용 범위**
- 모든 일반 그룹: 베지어 곡선 자동 적용
- 특별 처리 그룹: 각 그룹 특성에 맞는 곡선 알고리즘 적용
- 선 연결 두께: 줌 팩터에 따른 동적 조절 (50% 감소 적용)

#### 기술적 성과 및 학습사항

**Tkinter Canvas 한계 극복**
- 기본 `smooth` 옵션의 제한적 효과 확인
- 수동 베지어 곡선 구현을 통한 완전한 부드러움 달성
- 많은 작은 선분 연결 방식의 효과적임을 검증

**MediaPipe 랜드마크 시스템 심화 이해**
- 478개 랜드마크의 해부학적 정확성과 연결 규칙 파악
- 그룹 간 중복 랜드마크 처리 및 특별 연결 규칙 정립
- 좌우 대칭 구조 고려한 알고리즘 설계의 중요성 확인

**사용자 경험 중심 개발**
- 즉각적인 UI 문제 해결의 중요성 (스크롤, 레이아웃)
- 기능 복잡도보다 안정성과 사용성 우선 정책 확립
- 문제 지속 시 과감한 삭제 결정의 효과적임 검증

#### 현재 시스템 상태

**총 랜드마크 그룹**: 27개 (3개 신규 추가)
- 기본 얼굴 특징: 눈, 코, 입, 눈썹, 턱선 등
- 확장 영역: 이마, 미간, 볼, 팔자주름 등
- **신규 복합 그룹**: 하꺼풀영역, 상주변영역, 상꺼풀영역

**렌더링 시스템**: 완전 베지어 곡선 기반
- 해상도: 100개 구간, 세그먼트당 50개 점
- 모든 선 연결에 부드러운 곡선 적용
- 그룹별 맞춤 곡선 알고리즘 적용

**사용자 제어**: 최적화된 반응형 UI
- 랜드마크 크기, 폰트 크기 실시간 조절
- 27개 그룹 개별 가시성 제어
- 부드러운 줌/팬 기능 및 스크롤 지원

## 참고 자료

- [MediaPipe Face Mesh 공식 문서](https://developers.google.com/mediapipe/solutions/vision/face_landmarker)
- [MediaPipe GitHub Repository](https://github.com/google-ai-edge/mediapipe)
- [Face Mesh 468 포인트 시각화](https://github.com/google/mediapipe/issues/1615)

---

*마지막 업데이트: 2025-08-13*
*Face Simulator v4.17*